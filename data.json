{
    "ScriptEntry" :
    {
        "Header" : "#-------------------------------------------------------------#\r\n#----Initial Declarations-------------------------------------#\r\n#-------------------------------------------------------------#\r\n#region\r\n\r\n",
        "Body" :
        {
            "Declarations" : "Add-Type -AssemblyName PresentationCore, PresentationFramework, WindowsBase\r\n\r\n$Global:SyncHash = [HashTable]::Synchronized(@{})\r\n\r\n$Xaml = ",
            "Xaml" : "\u003cWindow\r\n\t\txmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\r\n\t\txmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\r\n\t\txmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\r\n\t\txmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\r\n\t\txmlns:local=\"clr-namespace:XamlGenerator\"\r\n\t\tmc:Ignorable=\"d\"\r\n\t\tTitle=\"MainWindow\" SizeToContent=\"WidthAndHeight\"\u003e\r\n\t\u003cStackPanel x:Name=\"StackPanel\" Height=\"450\" Width=\"800\"\u003e\r\n\t\t\u003cTextBox x:Name=\"TextBox\" Height=\"350\" Margin=\"10,10,10,0\"TextWrapping=\"Wrap\" VerticalScrollBarVisibility=\"Auto\" VerticalAlignment=\"Bottom\"/\u003e\r\n\t\t\u003cProgressBar x:Name=\"ProgressBar\" Height=\"20\" Margin=\"10,10,10,0\" VerticalAlignment=\"Bottom\"/\u003e\r\n\t\t\u003cButton x:Name=\"Button\" Content=\"Test UI\" HorizontalAlignment=\"Left\" VerticalAlignment=\"Bottom\" Margin=\"10\"/\u003e\r\n\t\u003c/StackPanel\u003e\r\n\u003c/Window\u003e\r\n\r\n"
        },
        "Footer" : "#region\r\n\r\n"
    },    
    "UtilityFunctions" :
    {
        "Header" : "#-------------------------------------------------------------#\r\n#----Utility Functions----------------------------------------#\r\n#-------------------------------------------------------------#\r\n#region\r\n\r\n",
        "Body" : "Function Start-RunspaceTask\r\n{\r\n\t[CmdletBinding()]\r\n\tParam([Parameter(Mandatory=$True,Position=0)][ScriptBlock]$ScriptBlock,\r\n\t\t[Parameter(Mandatory=$True,Position=1)][PSObject[]]$ProxyVars)\r\n\r\n\t$Runspace = [RunspaceFactory]::CreateRunspace($Host)\r\n\t$Runspace.ApartmentState = \u0027STA\u0027\r\n    $Runspace.ThreadOptions  = \u0027ReuseThread\u0027\r\n    $Runspace.Open()\r\n\r\n    ForEach($Var in $ProxyVars)\r\n    {\r\n        $Runspace.SessionStateProxy.SetVariable($Var.Name, $Var.Variable)\r\n    }\r\n\r\n    $Thread = [PowerShell]::Create(\u0027NewRunspace\u0027).AddScript($ScriptBlock)\r\n    $Thread.Runspace = $Runspace\r\n    \r\n    [Void]$Jobs.Add([PSObject]@{ PowerShell = $Thread ; Runspace = $Thread.BeginInvoke() })\r\n}\r\n\r\nFunction Update-Control\r\n{\r\n    [CmdletBinding()]\r\n    Param([Parameter(Mandatory=$True,Position=0)][System.Windows.Controls.Control]$Control,\r\n          [Parameter(Mandatory=$True,Position=1)][ScriptBlock]$ScriptBlock)\r\n\r\n    $Control.Dispatcher.Invoke($ScriptBlock, \u0027Normal\u0027)\r\n}\r\n\r\n$SyncHash.StartRunspaceTask = ${Function:Start-RunspaceTask}\r\n$SyncHash.UpdateControl     = ${Function:Update-Control}\r\n\r\n",
        "Footer" : "#endregion\r\n\r\n"
    },
    "JobCleanup" :
    {
        "Header" : "#-------------------------------------------------------------#\r\n#----Runspace Cleanup Subroutine------------------------------#\r\n#-------------------------------------------------------------#\r\n#region\r\n\r\n",
        "Body" : "# Background runspace to clean up jobs (credit to Boe Prox PoshRSJob module and FoxDeploy)\r\n$Jobs = [System.Collections.ArrayList]::Synchronized([System.Collections.ArrayList]::new())\r\n\r\n$JobCleanupScript = {\r\n    # Routine to handle completed runspaces\r\n    Do\r\n    {    \r\n        ForEach($Job in $Jobs)\r\n   {            \r\n            If($Job.Runspace.IsCompleted)\r\n            {\r\n                [Void]$Job.Powershell.EndInvoke($Job.Runspace)\r\n                $Job.PowerShell.Runspace.Close()\r\n                $Job.PowerShell.Runspace.Dispose()\r\n              $Runspace.Powershell.Dispose()\r\n                \r\n                $Jobs.Remove($Runspace)\r\n            }\r\n        }\r\n\r\n        Start-Sleep -Seconds 1\r\n    }\r\n    While ($SyncHash.CleanupJobs)\r\n}\r\n\r\nStart-RunspaceTask $JobCleanupScript @([PSObject]@{ Name=\u0027Jobs\u0027 ; Variable=$Jobs })\r\n\r\n",
        "Footer" : "#endregion\r\n\r\n"
    },
    "EventHandlers" :
    {
        "Header" : "#-------------------------------------------------------------#\r\n#----Control Event Handlers-----------------------------------#\r\n#-------------------------------------------------------------#\r\n#region\r\n\r\n$Button_Click = {\r\n    $SyncHash.TextBox.AppendText(\u0027Populating list...\u0027)\r\n\r\n    $SyncHash.FileList = Get-ChildItem $env:USERPROFILE\u0027\\Documents\\Code Projects\u0027 -File -Recurse -ErrorAction SilentlyContinue\r\n\r\n    $SyncHash.TextBox.AppendText(\u0027Done!\u0027)\r\n\r\n    $SyncHash.ProgressBar.Maximum  = $SyncHash.FileList.Count\r\n    $SyncHash.ProgressBar.Minimum  = 0\r\n    $SyncHash.ProgressBar.Value    = 0\r\n\r\n    \u0026 $SyncHash.StartRunspaceTask {\r\n        For($i = 1 ; $i -le $SyncHash.FileList.Count ; $i++)\r\n        {\r\n            \u0026 $SyncHash.UpdateControl $SyncHash.Window {\r\n                $SyncHash.TextBox.AppendText(\"`n$($SyncHash.FileList[$i].FullName)\")\r\n                $SyncHash.ProgressBar.Value = $i\r\n            }\r\n        }\r\n    } ([PSObject]@{ Name=\u0027SyncHash\u0027 ; Variable=$SyncHash })\r\n}\r\n\r\n#endregion",
        "Body" :
        [
            "$Button_Click = {\r\n    $SyncHash.TextBox.AppendText(\u0027Populating list...\u0027)\r\n\r\n    $SyncHash.FileList = Get-ChildItem $env:USERPROFILE\u0027\\Documents\\Code Projects\u0027 -File -Recurse -ErrorAction SilentlyContinue\r\n\r\n    $SyncHash.TextBox.AppendText(\u0027Done!\u0027)\r\n\r\n    $SyncHash.ProgressBar.Maximum  = $SyncHash.FileList.Count\r\n    $SyncHash.ProgressBar.Minimum  = 0\r\n    $SyncHash.ProgressBar.Value    = 0\r\n\r\n    \u0026 $SyncHash.StartRunspaceTask {\r\n        For($i = 1 ; $i -le $SyncHash.FileList.Count ; $i++)\r\n        {\r\n            \u0026 $SyncHash.UpdateControl $SyncHash.Window {\r\n                $SyncHash.TextBox.AppendText(\"`n$($SyncHash.FileList[$i].FullName)\")\r\n                $SyncHash.ProgressBar.Value = $i\r\n            }\r\n        }\r\n  } ([PSObject]@{ Name=\u0027SyncHash\u0027 ; Variable=$SyncHash })\r\n}\r\n\r\n"
        ],
        "Footer" : "#endregion\r\n\r\n"
    },
    "ScriptExecution" :
    {
        "Header" : "#-------------------------------------------------------------#\r\n#----Script Execution-----------------------------------------#\r\n#-------------------------------------------------------------#\r\n#region\r\n\r\n",
        "Body" :
        {
            "XamlImport" : "$SyncHash.Window = [Windows.Markup.XamlReader]::Parse($Xaml)\r\n\r\n$Elements = ([Xml]$Xaml).GetElementsByTagName(\u0027*\u0027)\r\n\r\nForEach($Element in $Elements)\r\n{\r\n    $Control = $SyncHash.Window.FindName($Element.Name)\r\n    If($Control) { $SyncHash.Add($Control.Name, $Control) }\r\n}\r\n\r\n",
            "EventSubscriptions" :
            [
                "$SyncHash.Button.Add_Click($Button_Click)\r\n",
                "\r\n"
            ],
            "WindowLaunch" : "$SyncHash.Window.Add_Closed({\r\n    Write-Verbose \u0027Halt runspace cleanup job processing\u0027\r\n    $SyncHash.CleanupJobs = $False\r\n})\r\n\r\n# Begin job cleanup subroutine\r\n$SyncHash.CleanupJobs = $True\r\n\r\n[Void]$SyncHash.Window.ShowDialog()\r\n$SyncHash.Error = $Error\r\n\r\n"
        },
        "Footer" : "#endregion\r\n\r\n"
    }
}